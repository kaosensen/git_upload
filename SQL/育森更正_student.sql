--實作練習二
create table MAIN_TABLE(
     ACCOMMODATION_NUMBER CHAR(8 BYTE)PRIMARY KEY,
     ADDRESS NVARCHAR2(100),
     PEOPLE VARCHAR2(10 BYTE),
     FLOOR_NUMBER VARCHAR2(10 BYTE),
     BUILD_CATEGORY CHAR(8 BYTE),
     VILLAGE_OFFICE CHAR(8 BYTE),
     FIRE_BRIGADE CHAR(8 BYTE));
     
alter table MAIN_TABLE
add foreign key (BUILD_CATEGORY) references BUILDING_CATEGORY(NM);
alter table MAIN_TABLE
add foreign key (VILLAGE_OFFICE) references OFFICE(OFFICE_NUMBER);
alter table MAIN_TABLE
add foreign key (FIRE_BRIGADE) references FB_INFORMATION(JD_NUMBER);


create table FB_INFORMATION(
     JD_NUMBER CHAR(8 BYTE)PRIMARY KEY,
     JD NVARCHAR2(20),
     BRANCH_ADDRESS VARCHAR2(100 BYTE),
     BRANCH_NUMBER VARCHAR2(10 BYTE)); 

create table BUILDING_CATEGORY(
     NM CHAR(8 BYTE)PRIMARY KEY,
     BUILDING NVARCHAR2(20)); 
     
create table OFFICE(
     OFFICE_NUMBER CHAR(8 BYTE)PRIMARY KEY,
     VILLAGE NVARCHAR2(20),
     VILLAGE_OFFICE NVARCHAR2(100),
     VILLAGE_PHONE VARCHAR2(10 BYTE)); 

--實作練習三
--寫入消防隊資訊

insert into FB_INFORMATION (JD_NUMBER,JD,BRANCH_ADDRESS,BRANCH_NUMBER)
values('M001','竹南分局','苗栗縣竹南鎮民族街72號','037474796');
insert into FB_INFORMATION  (JD_NUMBER,JD,BRANCH_ADDRESS,BRANCH_NUMBER)
values('M002','苗栗分局','苗栗縣苗栗市金鳳街109號','037320059');
insert into FB_INFORMATION (JD_NUMBER,JD,BRANCH_ADDRESS,BRANCH_NUMBER)
values('M003','頭份分局','苗栗縣頭份市中興路503號','037663004');

--寫入建築物類別
insert into BUILDING_CATEGORY (NM,BUILDING)
values('B01','公寓');
insert into BUILDING_CATEGORY (NM,BUILDING)
values('B02','大樓');
insert into BUILDING_CATEGORY (NM,BUILDING)
values('B03','公共設施');
insert into BUILDING_CATEGORY (NM,BUILDING)
values('B04','私營單位');

--寫入辦公室資訊
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C001','大埔里','苗栗縣竹南鎮民族街72號','037474796');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C002','竹南里','竹南鎮公義路1035號','037581072');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C003','山佳里','竹南鎮竹南里中山路103號','037472735');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C004','埔頂里','竹南鎮山佳里國光街14號','037614186');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C005','綠苗里','後龍鎮埔頂里中興路136-1號','037724839');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C006','民族里','民族里民族路96號','037660001');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C007','忠孝里','忠孝里光大街82號','037661145');
insert into OFFICE (OFFICE_NUMBER,VILLAGE,VILLAGE_OFFICE,VILLAGE_PHONE)
values('C008','信義里','信義里信義路53巷1號','037616072');

--寫入主表
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S01','苗栗縣竹南鎮中埔街20號','100','1','B01','C001','M001');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S02','苗栗縣竹南鎮和平街79號','3142','1','B02','C002','M001');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S03','苗栗縣竹南鎮龍山路三段142號','1075','1','B02','C003','M001');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S04','苗栗縣後龍鎮中華路1498號','32','1','B03','C004','M001');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S05','苗栗縣苗栗市米市街80號','106','1','B01','C005','M002');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S06','苗栗縣苗栗市光復路117號','26','1','B01','C005','M002');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S07','苗栗縣苗栗市博愛街109號','2038','2','B02','C005','M002');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S08','苗栗縣苗栗市大同路53號','128','2','B02','C005','M002');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S09','苗栗縣頭份市民族里和平路102號','353','1','B03','C006','M003');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S010','苗栗縣頭份市忠孝忠孝一路69號','501','1','B04','C007','M003');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S011','苗栗縣頭份市信義里中正路65號','194','1','B01','C008','M003');
insert into MAIN_TABLE (ACCOMMODATION_NUMBER,ADDRESS,PEOPLE,FLOOR_NUMBER,BUILD_CATEGORY,VILLAGE_OFFICE,FIRE_BRIGADE)
VALUES('S012','苗栗縣頭份市信義里中正路116號','78','1','B04','C008','M003');
--實作練習四

--四之一

select  distinct BBB.JD as 轄管分局,
        BBB.BRANCH_NUMBER as 分局連絡電話
 from STUDENT.MAIN_TABLE AAA
 inner join STUDENT.FB_INFORMATION BBB on AAA.FIRE_BRIGADE = BBB.JD_NUMBER
 where AAA.PEOPLE > 1000;

--四之二
select  BBB.JD as 轄管分局,
        BBB.BRANCH_NUMBER as 分局連絡電話,
        count(ADDRESS) over(partition by ADDRESS) as 避難設施大於1000容人數量的設施數量
 from STUDENT.MAIN_TABLE AAA
 inner join STUDENT.FB_INFORMATION BBB on AAA.FIRE_BRIGADE = BBB.JD_NUMBER
 where AAA.PEOPLE > 1000;
--group by BBB.JD,BBB.BRANCH_NUMBER;

--四之三
select  distinct BBB.JD as 轄管分局,
        BBB.BRANCH_NUMBER as 分局連絡電話,
        count(*) as 避難設施大於1000容人數量的設施數量,
        AAA.ADDRESS as 避難設施地址,
        CCC.BUILDING as 類型
 from STUDENT.MAIN_TABLE AAA
 inner join STUDENT.FB_INFORMATION BBB on AAA.FIRE_BRIGADE = BBB.JD_NUMBER
 inner join STUDENT.BUILDING_CATEGORY CCC on AAA.BUILD_CATEGORY = CCC.NM
 where AAA.PEOPLE > 1000
 group by BBB.JD,BBB.BRANCH_NUMBER,AAA.ADDRESS,CCC.BUILDING;

--四之四

select  BBB.JD as 轄管分局,
        BBB.BRANCH_NUMBER as 分局連絡電話,
        AAA.PEOPLE as 容人數量,
        AAA."ADDRESS" as 避難設施地址,
        DDD."VILLAGE" as 村里別 
 from STUDENT.MAIN_TABLE AAA
 inner join STUDENT.FB_INFORMATION BBB on AAA.FIRE_BRIGADE = BBB.JD_NUMBER
 inner join STUDENT.OFFICE DDD on AAA.VILLAGE_OFFICE = DDD."OFFICE_NUMBER"
 where AAA."ADDRESS" LIKE '%中%';

--主表 AAA
--消防分隊資訊 BBB
--建築物類別 CCC
--辦公室資訊 DDD

--四之五

select  DDD.VILLAGE as 村里別, 
        DDD.VILLAGE_OFFICE as 村里辦公室位置,
        AAA.ADDRESS as 避難設施地址,
        AAA.PEOPLE as 容人數量
        
 from STUDENT.MAIN_TABLE AAA
 inner join STUDENT.BUILDING_CATEGORY CCC on AAA.BUILD_CATEGORY = CCC.NM
 inner join STUDENT.OFFICE DDD on AAA.VILLAGE_OFFICE = DDD.OFFICE_NUMBER
 where CCC.NM = 'B01' OR CCC.NM = 'B02';
--where ccc.編號 in('B01','B02')

--實作練習五
--五之一
update MAIN_TABLE
set PEOPLE = '5000'
where ADDRESS = '苗栗縣竹南鎮和平街79號'


--五之二
delete from STUDENT.MAIN_TABLE
where PEOPLE < 1000
